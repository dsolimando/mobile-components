class MokoRoute extends HTMLElement{static get observedAttributes(){return["path","component","selected"]}removeFirstSlash(t){return 0===t.indexOf("/")?t.substring(1):t}attributeChangedCallback(t,e,s){"path"===t?this._path=this.removeFirstSlash(s):"component"===t?this._element||(this._element=s):"selected"===t&&(this._selected=s)}get path(){return this._path}get customElement(){return this._element}set path(t){this.setAttribute("path",t)}get selected(){return this._selected}set selected(t){this.setAttribute("selected",t)}}customElements.define("moko-route",MokoRoute);const customElement=(t,e=[])=>{const s=class extends HTMLElement{static get observedAttributes(){return[...e]}constructor(){super(),this.connectedCallbackNumCalls=0}async connectedCallback(){if(this.connectedCallbackNumCalls>0)return;const e=t.bind(this);this.toRender=await e(this),"string"==typeof this.toRender?this.innerHTML=this.toRender:(this.toRender instanceof HTMLElement||this.toRender instanceof DocumentFragment)&&this.appendChild(this.toRender),this.connectedCallbackNumCalls++}};return e.forEach(t=>{Object.defineProperty(s.prototype,t,{set(e){this.setAttribute(t,e)},get(){return this.getAttribute(t)}})}),s},Link=customElement(function(){const t=this.innerHTML,e=document.createElement("a");return e.href=this.to,e.innerHTML=t,e.onclick=(t=>{t.preventDefault(),t.stopPropagation(),this.closest("moko-switch-navigator, moko-stack-navigator","moko-tab-navigator").navigate(this.to)}),this.innerHTML="",e},["to"]);function isLocationPathMatchingRoute(t,e){const s=/(:\w+)/g,n=e.match(s)||[];let o=[];n.length>0&&(o=n.map(t=>t.slice(1)));const i=new RegExp(e.replace(s,"(\\w+)")),a=t.match(i);let r={};if(a){const[t,...e]=a;for(var c=0;c<n.length;c++)r[o[c]]=e[c]}return{match:a,urlData:r}}customElements.define("moko-link",Link);class NavigatorElement extends HTMLElement{constructor(){super()}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-ROUTE"===t.tagName)}searchAncestor(t){const e=t[0].parentElement.closest("moko-switch-navigator, moko-stack-navigator, moko-tab-navigator");return e?this.searchAncestor([e,...t]):t}getContentElement(){return this.routes[this.routes.length-1].nextElementSibling}connectedCallback(){this.extractChildRoutes(),this.navigators||(this.navigators=this.searchAncestor([this])),addEventListener("hashchange",this)}disconnectedCallback(){removeEventListener("hashchange",this)}navigate(t){location.hash=`${this.getAncestorMatchedRoute()}/${t}`}getAncestorMatchedRoute(){return this.navigators.length>1?this.navigators[this.navigators.length-2].matchedRouteLocation:""}syncHref(t=this){const e=[...t.querySelectorAll('moko-route[selected="true"], moko-tab-route[selected="true"]')],s=location.href.split("#")[0]+"#"+this.getAncestorMatchedRoute()+(this.getAncestorMatchedRoute()?"/":"")+this.matchedRouteLocation;e.reduce((t,e)=>{const s=`${t}/${e.path}`;return s!==location.href?history.pushState({},s,s):history.replaceState({},s,s),s},s)}searchMatchingRoute(){let t,e,s,n,o=this.getAncestorMatchedRoute(),i=location.hash.substring(1).replace(o,"");if(""===(i="/"===i[0]?i.replace("/",""):i))this.matchedRouteLocation="";else{for(const a of this.routes){a.selected=!1;const r=isLocationPathMatchingRoute(i,a.path);if(r.match){e=r,(t=a).selected=!0,s=(n=`${o}${o?"/":""}${e.match[0]}`)!==this.matchedRouteLocation;break}}s&&(this.matchedRouteLocation=n)}return{matchedRoute:t,matchedResult:e,ancestorMatchedRoute:o,routeChanged:s}}}function createWrapperElement(t){const e=document.createElement("div");return e.style.position="absolute",e.style.width="inherit",e.style.height="inherit",e.style.transition="transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)",t&&e.setAttribute("id",t),e}class StackNavigator extends NavigatorElement{static get observedAttributes(){return["modal"]}attributeChangedCallback(t,e,s){"modal"===t&&(this.modal||(this._modal=!(""!==s&&!s)))}get modal(){return this._modal}handleEvent(t){const{matchedResult:e,routeChanged:s,matchedRoute:n}=this.searchMatchingRoute();if(!e&&this.nextRoute&&this.onscreenFirstRoute(),e&&s){const t=document.createElement(n.customElement);t.style.display="block",Object.keys(e.urlData).forEach(s=>{t.setAttribute(s,e.urlData[s])}),this.nextRoute=createWrapperElement(),this.nextRoute.innerHTML="",this.nextRoute.appendChild(t),this.offscreenNextRoute(),setTimeout(()=>{this.appendChild(this.nextRoute),setTimeout(()=>{this.modal||(this.initialContentElement.style.transform="translateX(-30%)"),this.showNextRouteElement(t)},16)})}}offscreenNextRoute(){this.modal?this.nextRoute.style.transform="translateY(100%)":this.nextRoute.style.transform="translateX(100%)"}onscreenFirstRoute(){this.modal?this.nextRoute.style.transform="translateY(100%)":(this.nextRoute.style.transform="translateX(100%)",this.initialContentElement.style.transform="translateX(0)")}showNextRouteElement(){this.modal?this.nextRoute.style.transform="translateY(0)":this.nextRoute.style.transform="translateX(0)"}renderFirstRoute(){const t=document.createElement(this.routes[0].customElement);t.style.display="block";const e=createWrapperElement();e.appendChild(t),this.initialContentElement?this.initialContentElement.replaceWith(e):this.appendChild(e),this.initialContentElement=e}constructor(){super(),this.connectedCallbackNumCalls=0,this.style.position="relative",this.style.height="inherit",this.style.width="inherit",this.style.display="block",this.style.overflow="hidden"}connectedCallback(){super.connectedCallback(),this.initialContentElement=this.getContentElement(),0==this.connectedCallbackNumCalls++&&setTimeout(()=>{this.renderFirstRoute()})}}customElements.define("moko-stack-navigator",StackNavigator);export{StackNavigator};
