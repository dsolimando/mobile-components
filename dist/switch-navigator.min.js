class MokoRoute extends HTMLElement{static get observedAttributes(){return["path","component","selected"]}removeFirstSlash(t){return 0===t.indexOf("/")?t.substring(1):t}attributeChangedCallback(t,e,s){"path"===t?this._path=this.removeFirstSlash(s):"component"===t?this._element||(this._element=s):"selected"===t&&(this._selected=s)}get path(){return this._path}get customElement(){return this._element}set path(t){this.setAttribute("path",t)}get selected(){return this._selected}set selected(t){this.setAttribute("selected",t)}}customElements.define("moko-route",MokoRoute);const customElement=(t,e=[])=>{const s=class extends HTMLElement{static get observedAttributes(){return[...e]}constructor(){super(),this.connectedCallbackNumCalls=0}async connectedCallback(){if(this.connectedCallbackNumCalls>0)return;const e=t.bind(this);this.toRender=await e(this),"string"==typeof this.toRender?this.innerHTML=this.toRender:(this.toRender instanceof HTMLElement||this.toRender instanceof DocumentFragment)&&this.appendChild(this.toRender),this.connectedCallbackNumCalls++}};return e.forEach(t=>{Object.defineProperty(s.prototype,t,{set(e){this.setAttribute(t,e)},get(){return this.getAttribute(t)}})}),s},Link=customElement(function(){const t=this.innerHTML,e=document.createElement("a");return e.href=this.to,e.innerHTML=t,e.onclick=(t=>{t.preventDefault(),t.stopPropagation(),this.closest("moko-switch-navigator, moko-stack-navigator","moko-tab-navigator").navigate(this.to)}),this.innerHTML="",e},["to"]);function isLocationPathMatchingRoute(t,e){const s=/(:\w+)/g,o=e.match(s)||[];let n=[];o.length>0&&(n=o.map(t=>t.slice(1)));const a=new RegExp(e.replace(s,"(\\w+)")),i=t.match(a);let c={};if(i){const[t,...e]=i;for(var r=0;r<o.length;r++)c[n[r]]=e[r]}return{match:i,urlData:c}}customElements.define("moko-link",Link);class NavigatorElement extends HTMLElement{constructor(){super()}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-ROUTE"===t.tagName)}searchAncestor(t){const e=t[0].parentElement.closest("moko-switch-navigator, moko-stack-navigator, moko-tab-navigator");return e?this.searchAncestor([e,...t]):t}getContentElement(){return this.routes[this.routes.length-1].nextElementSibling}connectedCallback(){this.extractChildRoutes(),this.navigators||(this.navigators=this.searchAncestor([this])),addEventListener("hashchange",this)}disconnectedCallback(){removeEventListener("hashchange",this)}navigate(t){location.hash=`${this.getAncestorMatchedRoute()}/${t}`}getAncestorMatchedRoute(){return this.navigators.length>1?this.navigators[this.navigators.length-2].matchedRouteLocation:""}syncHref(t=this){const e=[...t.querySelectorAll('moko-route[selected="true"], moko-tab-route[selected="true"]')],s=location.href.split("#")[0]+"#"+this.getAncestorMatchedRoute()+(this.getAncestorMatchedRoute()?"/":"")+this.matchedRouteLocation;e.reduce((t,e)=>{const s=`${t}/${e.path}`;return s!==location.href?history.pushState({},s,s):history.replaceState({},s,s),s},s)}searchMatchingRoute(){let t,e,s,o,n=this.getAncestorMatchedRoute(),a=location.hash.substring(1).replace(n,"");if(""===(a="/"===a[0]?a.replace("/",""):a))this.matchedRouteLocation="";else{for(const i of this.routes){i.selected=!1;const c=isLocationPathMatchingRoute(a,i.path);if(c.match){e=c,(t=i).selected=!0,s=(o=`${n}${n?"/":""}${e.match[0]}`)!==this.matchedRouteLocation;break}}s&&(this.matchedRouteLocation=o)}return{matchedRoute:t,matchedResult:e,ancestorMatchedRoute:n,routeChanged:s}}}class MokoSwitchNavigator extends NavigatorElement{connectedCallback(){super.connectedCallback(),this.style.display="block",this.style.height="inherit",this.style.width="inherit",this.style.position="relative";const t=this.getAttribute("default-path");this.getContentElement()?this.matchedRouteLocation=t||this.routes[0].path:t&&this.navigate(t)}handleEvent(){const{matchedResult:t,matchedRoute:e,routeChanged:s}=this.searchMatchingRoute();if(t&&s){Array.from(this.routes).forEach(t=>t.innerHTML="");const s=this.getContentElement();s&&s.remove();const o=document.createElement(e.customElement);Object.keys(t.urlData).forEach(e=>{o.setAttribute(e,t.urlData[e])}),this.appendChild(o),this.dispatchEvent(new CustomEvent("moko-switch-view",{detail:{matchedRoute:e},bubbles:!0}))}}}customElements.define("moko-switch-navigator",MokoSwitchNavigator);export{MokoSwitchNavigator};
